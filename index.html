<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
        <script src="http://adapptalo.com/BBF/beers.js"></script>
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="kendo/styles/kendo.indexedlistview.css" rel="stylesheet" />
        	
        <link rel="stylesheet" href="leaflet/leaflet.css" />
        <script src="leaflet/leaflet.js"></script>

    </head>
<body>
        
<div data-role="view" id="beers-view" data-title="BeersList" data-layout="tabstrip-appearance" data-model="viewModel"  data-show="showHomeView">
        <ul id="custom-listview" data-role="indexedlistview" data-bind="source: beersL" data-template="beers-list-template" data-fixed-headers="true"></ul>
</div>

<script id="beers-list-template" type="text/x-kendo-template">
        <a style="height:60px;" data-role="listview-link" href="\#side-inbox?alert_ID=#:B_Id#">
            <img src="Images/beers/#=IMAGEN#" class="item-photo">
            <h3 class="item-title">#=CERVESERA#</h3>
            <p class="item-info">#=CERVESA#<br>
            <small>ABV:</small>#=ABV#%
            <small> IBU:</small>#=IBU#</p>
        </a>    
</script>  
<div data-role="view" id="side-inbox" data-show="showDetailsView">
    <header data-role="header">
      <div data-role="navbar">
        <a data-role="backbutton" data-align="left">Back</a>
        <span data-role="view-title">Beer Details</span>
      </div>
    </header>
    <ul id="beer_detail-list" data-role="listview" data-auto-bind="false" data-source="ds" data-template="productsTemplate"></ul>

</div>

<!--DETAIL VIEW LAYOUT-->     
<script id="productsTemplate" type="text/x-kendo-template">
    <div id="page-wrap" class="aside2">
        <h2 class="price">#=CERVESERA#</h2>
        
        <p class="price2">#=CERVESA#
                <img src="Images/beers/#=IMAGEN#" class="item-photo"><br><span class="bold">Estilo:</span>#=ESTIL#
                <br><span class="bold">ABV:</span>#=ABV#%
                <span class="bold"> IBU:</span>#=IBU#
                <br><span style="margin:0px;" class="km-icon km-globe"></span>#=PROCEDENCIA#

        </p>
        <p class="item-info2">#=DESCRIPCIO#</p>

        <a style="width:40%; float:left" data-role="button" data-bind="click: addToCart"  data-item-id="#:B_Id#">BEERWISH</a>
        <button style="width:40%; float:right; font-weight:bold; height:30px" class="km-button" onclick="socialsharingDemo()"><span class="km-text">SOCIALSHARING</span></button>
    </div>
        <input name="CName" type="text" data-bind="value: #=CERVESERA#" id="fName" />
        <input name="BName" type="text" data-bind="value: #=CERVESA#" id="lName" />

</script>

<div data-role="view" id="tabstrip-gallery" data-title="Gallery" data-layout="tabstrip-appearance">
    <ul data-role="listview" data-style="inset">
        <li><h2>Boston</h2><img src="http://demos.telerik.com/kendo-ui/content/mobile/overview/boston.jpg" /></li>
        <li><h2>Ottawa</h2><img src="http://demos.telerik.com/kendo-ui/content/mobile/overview/ottawa.jpg" /></li>
        <li><h2>San Francisco</h2><img src="http://demos.telerik.com/kendo-ui/content/mobile/overview/san-francisco.jpg" /></li>
        <li><h2>Liverpool</h2><img src="http://demos.telerik.com/kendo-ui/content/mobile/overview/liverpool.jpg" /></li>
        <li><h2>London</h2><img src="http://demos.telerik.com/kendo-ui/content/mobile/overview/london.jpg" /></li>
    </ul>
</div>

<div data-role="view" id="tabstrip-cities" data-title="Cities" data-layout="tabstrip-appearance">
    <ul data-role="listview" data-style="inset" data-type="group">
        <li>
            Africa
            <ul>
                <li data-icon="toprated"><a>Nairobi</a></li>
            </ul>
        </li>
        <li>
            America
            <ul>
                <li data-icon="globe"><a>Boston</a></li>
                <li data-icon="globe"><a>Ottawa</a></li>
                <li data-icon="toprated"><a>San Francisco</a></li>
            </ul>
        </li>
        <li>
            Asia
            <ul>
                <li data-icon="globe"><a>Bombay</a></li>
            </ul>
        </li>
        <li>
            Australia
            <ul>
                <li data-icon="globe"><a>Melbourne</a></li>
                <li data-icon="toprated"><a>Sydney</a></li>
            </ul>
        </li>
        <li>
            Europe
            <ul>
                <li data-icon="globe"><a>Cannes</a></li>
                <li data-icon="globe"><a>Liverpool</a></li>
                <li data-icon="toprated"><a>London</a></li>
            </ul>
        </li>
    </ul>
</div>

<div data-role="view" id="tabstrip-favourites" data-title="Favourites" data-layout="tabstrip-appearance">
    <ul data-role="listview" data-style="inset" data-type="group">
        <li>
            Favourite Cities
            <ul>
                <li data-icon="toprated"><a>Nairobi</a></li>
                <li data-icon="toprated"><a>San Francisco</a></li>
                <li data-icon="toprated"><a>Sydney</a></li>
                <li data-icon="toprated"><a>London</a></li>
            </ul>
        </li>
    </ul>
</div>
 
<div data-role="layout" data-id="tabstrip-appearance">
    <header data-role="header" id="tabstrip-appearance-header">
        <div data-role="navbar">
            <!--<a class="nav-button" data-align="left" data-role="backbutton">Back</a>-->
            <span data-role="view-title"></span>
            <a data-align="right" data-role="button" class="nav-button" href="#index">Index</a>
        </div>
    </header>

    <p>TabStrip</p>

    <div data-role="footer">
        <div data-role="tabstrip" id="custom-tabstrip">
            <a href="#beers-view" data-icon="favorites">BeerList</a>
            <a href="#tabstrip-gallery" data-icon="camera">Gallery
            </a><a href="#tabstrip-cities" data-icon="globe">Cities
            </a><a href="#index" data-icon="share">Map
            </a>
        </div>
    </div>
</div>
<style>
    #custom-tabstrip,
    #custom-tabstrip .km-button
    {
        background: url(http://demos.telerik.com/kendo-ui/content/shared/images/patterns/pattern3.png);
    }
    .km-ios .km-list > li{background-color: transparent !important;background-image: none !important}
    #side-inbox .item-photo{height: 100px; width: 100px}
    .aside{text-align: center;background: url(Images/etiqueta2.png) no-repeat;background-size: 100%; /*background-size: cover;background-size: contain;*/
        padding: 30px;
          text-align: center;
      }
     /*.km-group-container*/#side-inbox .km-content { 
            background: url(Images/beer_bg.jpg) no-repeat center center fixed; 
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
    }

    #page-wrap { /*width: 400px;*/ margin: 50px auto; padding: 20px; background: white; -moz-box-shadow: 0 0 20px black; -webkit-box-shadow: 0 0 20px black; box-shadow: 0 0 20px black; }
    #side-inbox .item-photo {
        background-color: #FFFFFF;
        height: 75px;
        margin-left: 10px;
        margin-right: 10px;
       /* padding: 10px;*/
        width: 75px;
        float:left;
    }
    
    #side-inbox p.price2 {
        font-size: 13px;
        font-style: italic;
        margin-top: 5px;
        min-height: 95px;
        padding: 0;
    }
    #side-inbox .km-content .price {
        display: block;
        font-size: 15px;
        margin-bottom: 0;
    }
    .item-info2 {
        color: #974D2E;
        font-size: 11px;
        line-height: 2em;
    }
    #side-inbox .km-group-title{display: none;}
    .km-group-title, .km-list > li, .km-root .km-listview-link, .km-root .km-listview-label{padding: 0 !important}
    //.km-list > li, .km-root .km-listview-link, .km-root .km-listview-label{padding: 0.5em 0.4em !important;}
    /*#beers-view .km-listview .km-list {
        border-top-color: #dcbe87;
        background-image: url(http://demos.telerik.com/kendo-ui/content/shared/images/patterns/pattern8.png);
    }

    #beers-view .km-ios .km-list > li{background: transparent !important;}
    #beers-view .km-scroll-header, #beers-view .km-group-title {
        color: #974d2e;
        font-weight: normal;
        font-size: 1.4em;
        background-image: -moz-linear-gradient(center top , rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.45) 6%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.15) 50%, rgba(100, 100, 100, 0)), url(http://demos.telerik.com/kendo-ui/content/shared/images/patterns/pattern4.png);
        background-image: -webkit-gradient(linear, 50% 0, 50% 100%, color-stop(0, rgba(255, 255, 255, 0.5)), color-stop(0.06, rgba(255, 255, 255, 0.45)), color-stop(0.5, rgba(255, 255, 255, 0.2)), color-stop(0.5, rgba(255, 255, 255, 0.15)), color-stop(1, rgba(100, 100, 100, 0))), url(http://demos.telerik.com/kendo-ui/content/shared/images/patterns/pattern4.png);
    }
    .km-ios .km-group-title{background-color: transparent !important;background-image: none !important}*/
     #tabstrip-gallery h2 {
        display: inline-block;
        font-size: 1.1em;
        margin: 1em 0 1.5em 1em;
    }

    #tabstrip-gallery img {
	    float: left;
        width: 4em;
        height: 4em;
        margin: 0;
        -webkit-box-shadow: 0 1px 3px #333;
        box-shadow: 0 1px 3px #333;
        -webkit-border-radius: 8px;
        border-radius: 8px;
    }

</style>
<style scoped>
#beers-view .km-content {
    background-color: #f0f0f0;
}

#beers-view .km-navbar .km-button {
    background-color: #974d2e;
}

#beers-view .km-navbar,
.km-wp-light #beers-view .km-navbar,
.km-wp-dark #beers-view .km-navbar,
#beers-view .km-content .km-button {
    background: url(Images/pattern9.png);
    color: #ffffff;
}


/*#side-inbox .km-navbar,
.km-wp-light #side-inbox .km-navbar,
.km-wp-dark #side-inbox .km-navbar,
#side-inbox .km-content .km-button */ .km-navbar,
.km-wp-light .km-navbar,
.km-wp-dark .km-navbar,
.km-content .km-button {
    background: url(Images/pattern9.png);
    color: #ffffff;
}


#beers-view .item-photo {
    width: 40px;
    height: 40px;
    float: left;
    //margin: .5em 0;
    margin-left: 10px;
    margin-top: 8px;
    -webkit-box-shadow: 0 1px 3px #333;
    box-shadow: 0 1px 3px #333;
    -webkit-border-radius: 8px;
    border-radius: 8px;
}

#custom-listview .item-title {
    float: left;
    font-size: 13px;
    line-height: 1.4em;
    margin: .3em 1em 0 .6em;
    width: 70%;
}
#custom-listview .item-info {
    float: left;
    font-size: .7em;
    line-height: 1em;
    margin: 0 0 0 .95em;
    width: 75%;
}

#custom-listview .item-title,
#custom-listview .item-info {
    color: #4c2a1b;
}

#custom-listview .item-info {
    color: #974d2e;
}

#custom-listview {
    margin: 0;
}

#beers-view .details-link {
    margin-top: -1em;
    position: absolute;
    right: 0.6em;
    top: 50%;
}

#beers-view .km-listview .km-list {
    margin: 0;
}

#beers-view .km-listview .km-group-title {
    padding: 0;
    border-top: 0;
    box-shadow: none;
}

#beers-view .km-group-title h2 {
    margin: 0;
    padding-top: .2em;
    text-shadow: none;
}

#beers-view .km-group-title {
    color: #974d2e;
    /*font-weight: normal;
    font-size: 1em;*/
    background-image: -moz-linear-gradient(center top , rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.45) 6%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.15) 50%, rgba(100, 100, 100, 0)), url(Images/pattern4.png);
    background-image: -webkit-gradient(linear, 50% 0, 50% 100%, color-stop(0, rgba(255, 255, 255, 0.5)), color-stop(0.06, rgba(255, 255, 255, 0.45)), color-stop(0.5, rgba(255, 255, 255, 0.2)), color-stop(0.5, rgba(255, 255, 255, 0.15)), color-stop(1, rgba(100, 100, 100, 0))), url(Images/pattern4.png);
}

#beers-view .km-listview .km-list {
    border-top-color: #dcbe87;
    background-image: url(Images/pattern8.png);
}
.km-tablet .km-ios #beers-view .km-view-title
{
    color: #fff;
    text-shadow: 0 -1px rgba(0,0,0,.5);
}
.km-wp .km-group-title .km-text {
    padding: 0;
}
.km-wp .km-group-title .km-text h2 {
    padding: 0 0 .1em .7em;
}
.km-ios7 #beers-view .km-navbar .km-button,
.km-ios7 #beers-view .km-navbar .km-view-title
{
    background: transparent;
    color: #fff;
}
</style>   
<div data-role="view" data-title="Test app" data-layout="tabstrip-appearance" data-stretch="true" data-init="mapShow" id="index">
    <div id="map" style="border-collapse: collapse; width:100%;"></div>
</div>

    
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://cdn.kendostatic.com/2013.1.319/js/kendo.mobile.min.js"></script>
    <script src="kendo.indexedlistview.js"></script>

    
            <script type="text/javascript">
            localStorage.setItem('movieArray', JSON.stringify(beers));
            var retrievedMovieArray = JSON.parse(localStorage.getItem('movieArray'));
            var numb = JSON.parse(localStorage.getItem('movieArray')).length;
            
            var beersDataSource2 = new kendo.data.DataSource({
                    data: JSON.parse(localStorage.getItem('movieArray')),
                    group: [{field: "FirstLetter"}],
                    schema: {
                            parse: function (data) {
                                    $.each(data, function (index, artist) {
                                            artist.FirstLetter = artist.CERVESERA.substring(0,1).toUpperCase();
                                            if(artist.FirstLetter.match(/\d/)) {
                                                    artist.FirstLetter = "#"
                                            }
                                    });
                                    return data;
                            }
                    }
            });
            var ds = beersDataSource2;

            function showDetailsView(e) {
                //alert(parseInt(e.view.params.alert_ID));
                ds.filter({
                    field: "B_Id",
                    operator: "eq",
                    value: parseInt(e.view.params.alert_ID)
                });

                ds.read();
            }

            //alert('typeof retrievedMovieArray: ' + typeof retrievedMovieArray);
            //console.log('retrievedMovieArray:');
            /*for (var p in retrievedMovieArray) {
                console.log(p +'->'+ retrievedMovieArray[p].CERVESA +'|'+retrievedMovieArray[p].CERVESERA+'|'+retrievedMovieArray[p].ESTIL+'|'+retrievedMovieArray[p].ABV);
            }*/
            
            //var app = new kendo.mobile.Application(document.body, { hideAddressBar: true, loading: '<h1>@LL.Common.WAITING</h1>' });

            function mapShow(e) {
                var map = L.map('map');

                var greenIcon = L.icon({
                    iconUrl: 'Images/iconBBF.png',
                    //shadowUrl: 'leaf-shadow.png',
                    iconSize:     [75, 75], // size of the icon
                    //shadowSize:   [50, 64], // size of the shadow
                    iconAnchor:   [35, 75], // point of the icon which will correspond to marker's location
                    //shadowAnchor: [4, 62],  // the same for the shadow
                    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
                });
                L.marker([41.375553,2.149284], {icon: greenIcon}).addTo(map)
                            .bindPopup("<b>Barcelona Beer Festival</b><br />8, 9 y 10 de Marzo.").openPopup();

                L.tileLayer(
                  'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                  {maxZoom: 18}
                ).addTo(map);

                map.setView([41.375553,2.149284], 15);

                document.getElementById('map').style.display = 'block';

                function onLocationFound(e) {
                            var radius = e.accuracy / 2;

                            L.marker(e.latlng).addTo(map)
                                    .bindPopup("Usted está alrededor de " + radius + " metros de este punto").openPopup();

                            L.circle(e.latlng, radius).addTo(map);
                    }

                    function onLocationError(e) {
                            alert(e.message);
                    }
                    map.on('locationfound', onLocationFound);
                    map.on('locationerror', onLocationError);

                    //map.locate({setView: true, maxZoom: 16});
                    map.locate({setView: true, maxZoom: 16, watch: true, enableHighAccuracy: true, maximumAge: 15000, timeout: 3000000,});


                // Uncommenting  this line causes map to render properly
                map.invalidateSize();
                //setTimeout(map.invalidateSize.bind(map));
            }
        </script>
        <script type="text/javascript">

                    var beersDataSource = new kendo.data.DataSource({
                            data: beers,
                            group: [{field: "FirstLetter"}],
                            schema: {
                                    parse: function (data) {
                                            $.each(data, function (index, artist) {
                                                    artist.FirstLetter = artist.CERVESERA.substring(0,1).toUpperCase();
                                                    if(artist.FirstLetter.match(/\d/)) {
                                                            artist.FirstLetter = "#"
                                                    }
                                            });
                                            return data;
                                    }
                            }
                    });

                    var viewModel = kendo.observable({
                            beersL: beersDataSource
                    });

                    //var app = new kendo.mobile.Application(document.body);

                    // this just fixes a glitch in this demo page.
                    // not needed in real Kendo Mobile use.
                    //setTimeout(function () {$(".km-indexedlistview").data("kendoMobileIndexedListView").refresh();}, 1);
                    function showHomeView(e) {
                        //alert("showHomeView");
                        setTimeout(function () {$(".km-indexedlistview").data("kendoMobileIndexedListView").refresh();}, 1);
                    }

            </script>
            <script>
                    var app = new kendo.mobile.Application(document.body);

            </script>
</body>
</html>