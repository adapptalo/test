<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <style>
          
        body {
            background:#111;
            color:#ccc;
            font-family:"Segoe WP", Verdana, Geneva, sans-serif;
            margin:12px 12px;
            border-top:1px solid #000;
            font-size:24px;
        }

        div.info {
            margin-left:20px;
            font-size: 24px;
        }

        span.btn {
            background: #000;
            color: #FFF;
            text-decoration: none;
            line-height:32px;
            min-height:32px;
            min-width:80px;
            font-size: 24px;
            text-decoration:none;
            text-align:center;
            padding:12px 12px;
            margin:8px 8px;
            font-family:"Segoe WP Semibold";
            border:solid #E8126E 1px;
        }
        </style>
        <title>Compass Demo</title>
    </head>
    <body>

        <div style="margin:40px auto;text-align:center">
            <img id="compassRose" src="CompassRose.png" >
        </div>

        <div class="info" style="color:#84E812;" id="trueHeadingTxt">trueHeading : </div>
        <div class="info" style="color:#12A4E8;" id="magHeadingTxt">magneticHeading :</div>
        <div class="info" style="color:#FA15B9;" id="accuracyTxt">headingAccuracy :</div>
        <div class="info" style="color:#E8D311;" id="timestampTxt">timestamp :</div>
      
        <div style="margin:40px 40px;">
            <span id="toggleBtn" class="btn" onclick="toggleWatch(true);">Start Watch</span>
            <span class="btn" onclick="getCurrentHeading();">Get Heading</span>  
        </div>

        <div id="errMsg" class="info" style="background-color:Red;color:#000;">
        </div>
        
<script type="text/javascript">

    document.addEventListener("deviceready", onDeviceReady, false);

    var compassWatchId = null;

    // once the device ready event fires, you can safely do your thing! -jm
    function onDeviceReady() {
        console.log("onDeviceReady. You should see this message in Visual Studio's output window.");
    }


    function onHeadingUpdate(heading) {

        compassRose.style.transform = "rotate(-" + heading.trueHeading + "deg)";
        trueHeadingTxt.innerText = "trueHeading : " + heading.trueHeading;
        magHeadingTxt.innerText = "magneticHeading : " + heading.magneticHeading;
        accuracyTxt.innerText = "headingAccuracy : " + heading.headingAccuracy;
        timestampTxt.innerText = "timestamp : " + heading.timestamp;
    }

    function onCompassFail(err) {
        var msg = err == CompassError.COMPASS_NOT_SUPPORTED ? "Compass not supported" : "Internal Error";
        errMsg.innerText = "Compass Error : " + err + " - " + msg;
    }

    function getCurrentHeading() {
        navigator.compass.getCurrentHeading(onHeadingUpdate, onCompassFail);
    }

    function toggleWatch() {
        errMsg.innerText = "";

        if (compassWatchId) {
            navigator.compass.clearWatch(compassWatchId);
            compassWatchId = null;
            toggleBtn.innerText = "Start Watch";
        }
        else {
            compassWatchId = navigator.compass.watchHeading(onHeadingUpdate, onCompassFail, { frequency: 1000 });
            toggleBtn.innerText = "Stop Watch";
        }
    }

</script>
    
    </body>
</html>
